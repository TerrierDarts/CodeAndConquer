<span  class="badge badge--item">PAGE VIEWS:</span><span id="page-views">Loading ...</span>


<script type="module">
  if (typeof window !== 'undefined') {
    const pathname = window.location.pathname.replace("/blog/", "").replace("/", "");
    console.log('Current pathname:', pathname); // Debug log to verify pathname
  
    async function loadViews() {
      try {
        // Log the data to be sent in the request body
        const requestData = { pathname };
        console.log('Request data:', requestData);
  
        const res = await fetch('/api/views', {
          method: 'GET',
          headers: { 
            'Content-Type': 'application/json' 
          },
          body: JSON.stringify(requestData)  // Ensure the body is a valid JSON object
        });
  
        // Log the response status and body to see any errors returned
        console.log('Response status:', res.status);
        const responseBody = await res.text();  // Get the response as text
        console.log('Response body:', responseBody);  // Log the raw response body
  
        if (!res.ok) {
          throw new Error(`Failed to update views: ${res.status}. Response body: ${responseBody}`);
        }
  
        const data = JSON.parse(responseBody);
        console.log('Response data:', data);
  
        // Fetch the updated view count for the current page
        const getRes = await fetch(`/api/views?pathname=${pathname}`);
        const getData = await getRes.json();
        
        // Update the page with the new view count
        const viewElement = document.getElementById('page-views');
        console.log('Fetched views:', getData.views);
        if (viewElement) {
          viewElement.textContent = `PAGE VIEWS: ${getData.views}`;
        }
      } catch (err) {
        console.error('Failed to load views', err);
      }
    }
  
    loadViews();
  }
  </script>
  
  